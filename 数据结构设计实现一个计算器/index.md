# ã€æ•°æ®ç»“æ„è®¾è®¡ã€‘å®ç°ä¸€ä¸ªè®¡ç®—å™¨


## 1 é¢˜ç›®

å®ç°ä¸€ä¸ªè®¡ç®—å™¨ï¼ŒåŠŸèƒ½å¦‚ä¸‹ï¼š

1ã€è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¯ä»¥åŒ…å« + - * /ã€æ•°å­—ã€æ‹¬å·ä»¥åŠç©ºæ ¼ï¼Œä½ çš„ç®—æ³•è¿”å›è¿ç®—ç»“æœã€‚

2ã€è¦ç¬¦åˆè¿ç®—æ³•åˆ™ï¼Œæ‹¬å·çš„ä¼˜å…ˆçº§æœ€é«˜ï¼Œå…ˆä¹˜é™¤ååŠ å‡ã€‚

3ã€é™¤å·æ˜¯æ•´æ•°é™¤æ³•ï¼Œæ— è®ºæ­£è´Ÿéƒ½å‘ 0 å–æ•´ï¼ˆ5/2=2ï¼Œ-5/2=-2ï¼‰ã€‚

4ã€å¯ä»¥å‡å®šè¾“å…¥çš„ç®—å¼â¼€å®šåˆæ³•ï¼Œä¸”è®¡ç®—è¿‡ç¨‹ä¸ä¼šå‡ºç°æ•´å‹æº¢å‡ºï¼Œä¸ä¼šå‡ºç°é™¤æ•°ä¸º 0 çš„æ„å¤–æƒ…å†µã€‚  

## 2 è§£æ

### 2.1 å­—ç¬¦ä¸²è½¬æ•´æ•°

```c++
// æŠŠå­—ç¬¦ä¸²sè½¬ä¸ºæ•´æ•°n
int n = 0;
for (int i = 0; i < s.size(); i++) {
	char c = s[i];
	n = 10 * n + (c - '0');
}
```

â—â—â— æ³¨æ„ (c - '0')  çš„æ‹¬å·ä¸èƒ½çœç•¥ï¼Œå¦åˆ™å¯èƒ½é€ æˆæ•´å‹æº¢å‡ºã€‚  

### 2.2 å¤„ç†åŠ å‡æ³•

ğŸŸ  å…ˆç»™ç¬¬â¼€ä¸ªæ•°å­—åŠ â¼€ä¸ªé»˜è®¤ç¬¦å· +ï¼Œå˜æˆ +1-12+3ã€‚ 

ğŸŸ¡ æŠŠâ¼€ä¸ªè¿ç®—ç¬¦å’Œæ•°å­—ç»„åˆæˆâ¼€å¯¹ï¼Œä¹Ÿå°±æ˜¯ä¸‰å¯¹ +1ï¼Œ-12ï¼Œ+3ï¼ŒæŠŠå®ƒä»¬è½¬åŒ–æˆæ•°å­—ï¼Œç„¶åæ”¾åˆ°â¼€ä¸ªæ ˆ ä¸­ã€‚ 

ğŸŸ¢ å°†æ ˆä¸­æ‰€æœ‰çš„æ•°å­—æ±‚å’Œï¼Œå°±æ˜¯åŸç®—å¼çš„ç»“æœã€‚

```c++
int calculate(string s) {
	stack<int> stk;
	// è®°å½•ç®—å¼ä¸­çš„æ•°å­—
	int num = 0;
	// è®°å½• num å‰çš„ç¬¦å·ï¼Œåˆå§‹åŒ–ä¸º +
	char sign = '+';
	for (int i = 0; i < s.size(); i++) {
		char c = s[i];
		// å¦‚æœæ˜¯æ•°å­—ï¼Œè¿ç»­è¯»å–åˆ° num
		if (isdigit(c))
		num = 10 * num + (c - '0');
		// å¦‚æœä¸æ˜¯æ•°å­—ï¼Œå°±æ˜¯é‡åˆ°äº†ä¸‹â¼€ä¸ªç¬¦å·ï¼Œ
		// ä¹‹å‰çš„æ•°å­—å’Œç¬¦å·å°±è¦å­˜è¿›æ ˆä¸­
		if (!isdigit(c) || i == s.size() - 1) {
			switch (sign) {
				case '+':
					stk.push(num); break;
				case '-':
					stk.push(-num); break;
			}
			// æ›´æ–°ç¬¦å·ä¸ºå½“å‰ç¬¦å·ï¼Œæ•°å­—æ¸…é›¶
			sign = c;
			num = 0;
		}
 	}
 	// å°†æ ˆä¸­æ‰€æœ‰ç»“æœæ±‚å’Œå°±æ˜¯ç­”æ¡ˆ
 	int res = 0;
 	while (!stk.empty()) {
 		res += stk.top();
 		stk.pop();
 	}
 	return res;
}
```

### 2.3 å¤„ç†ä¹˜é™¤æ³•

æ€è·¯è·Ÿä»…å¤„ç†åŠ å‡æ³•ç±»ä¼¼ï¼Œå…¶ä»–éƒ¨åˆ†éƒ½ä¸å˜ï¼Œåªéœ€è¦åœ¨ switch éƒ¨åˆ†åŠ ä¸Šå¯¹åº”çš„ case ã€‚

```c++
for (int i = 0; i < s.size(); i++) {
 	char c = s[i];
 	if (isdigit(c))
	num = 10 * num + (c - '0');
 	if (!isdigit(c) || i == s.size() - 1) {
 		switch (sign) {
 			int pre;
 			case '+':
 				stk.push(num); break;
 			case '-':
 				stk.push(-num); break;
 				// åªè¦æ‹¿å‡ºå‰â¼€ä¸ªæ•°å­—åšå¯¹åº”è¿ç®—å³å¯
 			case '*':
 				pre = stk.top();
 				stk.pop();
 				stk.push(pre * num);
 				break;
 			case '/':
 				pre = stk.top();
 				stk.pop();
 				stk.push(pre / num);
 				break;
 		}
 		// æ›´æ–°ç¬¦å·ä¸ºå½“å‰ç¬¦å·ï¼Œæ•°å­—æ¸…é›¶
 		sign = c;
 		num = 0;
 	}
}
```

å½“é‡åˆ°ç©ºæ ¼æ—¶ï¼Œåªéœ€è¦æ§åˆ¶ç©ºæ ¼ä¸è¿›å…¥ if æ¡ä»¶ï¼š

```c++
if ((!isdigit(c) && c != ' ') || i == s.size() - 1) {
 	...
}
```

### 2.4 å¤„ç†æ‹¬å·

ğŸ’¥ **æ‹¬å·å…·æœ‰é€’å½’æ€§è´¨ã€‚** æˆ‘ä»¬åªéœ€åœ¨éå†æ—¶ï¼Œé‡åˆ°  `(`  å¼€å§‹é€’å½’ï¼Œé‡åˆ°  `)`  ç»“æŸé€’å½’ã€‚

```Python
def calculate(s: str) -> int:

 	def helper(s: List) -> int:
 		stack = []
 		sign = '+'
 		num = 0
 		while len(s) > 0:
 			c = s.popleft()
 			if c.isdigit():
 				num = 10 * num + int(c)
 			# é‡åˆ°å·¦æ‹¬å·å¼€å§‹é€’å½’è®¡ç®— num
 			if c == '(':
				num = helper(s)
 			if (not c.isdigit() and c != ' ') or len(s) == 0:
 				if sign == '+':
 					stack.append(num)
	 			elif sign == '-':
 					stack.append(-num)
 				elif sign == '*':
 					stack[-1] = stack[-1] * num
 				elif sign == '/':
 					# python é™¤æ³•å‘ 0 å–æ•´çš„å†™æ³•
 					stack[-1] = int(stack[-1] / float(num))
 				num = 0
 				sign = c
 			# é‡åˆ°å³æ‹¬å·è¿”å›é€’å½’ç»“æœ
 			if c == ')': break
 		return sum(stack)
    
 return helper(collections.deque(s))
```


